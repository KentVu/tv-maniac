#!/bin/sh

echo "Running pre-commit checks..."

# Run spotlessCheck to verify code formatting
echo "Checking code formatting with Spotless..."
./gradlew spotlessCheck

# Check the exit code of the spotlessCheck command
if [ $? -ne 0 ]; then
  echo "‚ùå Code formatting check failed. Please run './gradlew spotlessApply' to fix formatting issues."
  exit 1
fi

echo "‚úÖ Code formatting check passed."

# Check Swift code formatting with SwiftFormat
if [ -d "ios" ]; then
  echo "Checking Swift code formatting with SwiftFormat..."

  # Check if SwiftFormat is installed
  if ! command -v swiftformat &> /dev/null; then
    echo "‚ùå SwiftFormat is not installed. Please install it using 'brew install swiftformat'."
    exit 1
  fi

  # Run SwiftFormat check
  cd ios && swiftformat . --config .swiftformat --lint

  # Check the exit code
  if [ $? -ne 0 ]; then
    echo "‚ùå Swift code formatting check failed. Please run 'cd ios && swiftformat . --config .swiftformat' to fix formatting issues."
    exit 1
  fi

  echo "‚úÖ Swift code formatting check passed."
  cd ..
fi

echo "All pre-commit checks passed! üéâ"
exit 0
